# ADR-049: Server-Side Scoring Authority

- **Status:** ✅ Decidido (requisito PO)
- **Date:** 27-feb-2026
- **Deciders:** PO (Sergio)
- **Supersedes:** HUB_SPEC.md v1 §1 (scoring local + validación server)

## Decisión

El Hub AICE es la autoridad de scoring. El cliente (skill) es un clasificador de eventos, NO un calculador de scores.

## Contexto

### Modelo anterior (HUB_SPEC v1)
```
Skill evalúa localmente → calcula deltas → envía score al hub → hub valida y almacena
```

Problema: El cliente puede falsear cualquier cosa — deltas, scores, streaks, eval counts. Las validaciones del hub (rangos, monotonía) son defensas superficiales contra un cliente determinado a hacer gaming.

### Modelo nuevo
```
Skill clasifica evento → envía clasificación al hub → hub calcula score → devuelve resultado
```

El cliente NUNCA ve la lógica de scoring. Solo clasifica: "esto fue un error medio en TECH, patrón HALLUCINATION." El hub aplica todas las reglas AICE (ACC, streaks, caps, warmup, clusters, reincidencia) y devuelve el score actualizado.

## Qué se mueve al servidor

| Componente | Antes (cliente) | Ahora (servidor) |
|-----------|:-:|:-:|
| Clasificación de evento (tipo, dominio, severidad) | Cliente | Cliente |
| Cálculo de delta | Cliente | **Servidor** |
| Gestión de streaks | Cliente | **Servidor** |
| Caps diarios | Cliente | **Servidor** |
| Warmup | Cliente | **Servidor** |
| Clusters (cadena causal) | Cliente | **Servidor** |
| Reincidencia | Cliente | **Servidor** |
| ACC table (streak rewards) | Cliente | **Servidor** |
| Team score (ownership-weighted) | Cliente | **Servidor** |
| Anti-patrón tracking | Cliente | **Servidor** |
| Pro-patrón tracking | Cliente | **Servidor** |

## Consecuencias

### Positivas
- **Anti-gaming por diseño:** El cliente no puede falsear scores porque no los calcula
- **Reglas actualizables:** Cambiar la ACC table o caps solo requiere update del servidor, no de todos los clientes
- **Consistencia:** Una sola implementación de las reglas AICE, no N implementaciones por cada plataforma
- **Auditabilidad:** El servidor tiene el historial completo de eventos y puede recalcular scores desde cero

### Negativas
- **Dependencia de red:** Sin conexión no hay scoring (mitigación: cola offline, ver ADR-051)
- **Latencia:** El cliente no sabe el score hasta que el servidor responde
- **Complejidad del servidor:** El scoring engine es significativamente más complejo que un validador

### Cambios en la skill
- `confidence.json` pasa de "fuente de verdad" a "caché del último score conocido"
- La skill ya no necesita implementar ACC, streaks, caps, etc.
- La skill se simplifica: clasificar + enviar + mostrar resultado
